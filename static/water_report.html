<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Water Testing Report</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .report-card {
            box-shadow: 0 12px 30px rgba(0, 0, 0, 0.15);
        }

        .input-group label {
            display: block;
            margin-bottom: 0.25rem;
            font-size: 0.875rem;
            line-height: 1.25rem;
            font-weight: 600;
            color: rgb(55 65 81);
        }

        .input-field,
        .select-field {
            width: 100%;
            padding: 0.75rem;
            border-width: 1px;
            border-color: rgb(209 213 219);
            border-radius: 0.5rem;
            transition-property: all;
            transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
            transition-duration: 150ms;
        }

        .input-field:focus,
        .select-field:focus {
            outline: 2px solid transparent;
            outline-offset: 2px;
            --tw-ring-offset-shadow: var(--tw-ring-inset) 0 0 0 var(--tw-ring-offset-width) var(--tw-ring-offset-color);
            --tw-ring-shadow: var(--tw-ring-inset) 0 0 0 calc(2px + var(--tw-ring-offset-width)) rgb(34 197 94);
            box-shadow: var(--tw-ring-offset-shadow), var(--tw-ring-shadow), var(--tw-shadow, 0 0 #0000);
        }

        #map {
            height: 320px;
        }
    </style>
    <script async defer
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDZWZXkBxdSevip6RNE6NpiyvHiV6SP9nw&callback=initMap"></script>
</head>

<body class="bg-gray-900 font-sans min-h-screen p-4 sm:p-8">
    <div id="app" class="max-w-4xl mx-auto">
        <header class="text-center mb-6 pt-2">
            <h1 class="text-3xl font-extrabold text-gray-200">Water Quality Report</h1>
            <p class="text-gray-600 mt-1">Community Water Surveillance</p>
        </header>

        <div class="report-card bg-gray-950 p-6 sm:p-10 rounded-2xl">
            <form id="waterReportForm">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                    <div class="input-group">
                        <label for="village_id">Village</label>
                        <select id="village_id" name="village_id" required class="input-field">
                            <option value="">Select Village</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label for="ph_level">pH Level</label>
                        <input type="number" step="0.1" id="ph_level" name="ph_level" required class="input-field">
                    </div>
                    <div class="input-group">
                        <label for="turbidity">Turbidity (NTU)</label>
                        <input type="number" step="0.1" id="turbidity" name="turbidity" required class="input-field">
                    </div>
                    <div class="input-group">
                        <label for="contamination_type">Contamination Type (Optional)</label>
                        <input type="text" id="contamination_type" name="contamination_type" class="input-field">
                    </div>
                </div>

                <button type="submit"
                    class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-4 px-4 rounded-xl transition shadow-xl">
                    Submit Report
                </button>
            </form>
            <div id="messageBox" class="mt-8 hidden p-4 rounded-xl text-center"></div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            loadVillages();
        });

        async function loadVillages() {
            try {
                const response = await fetch('/api/villages');
                const villages = await response.json();
                const villageSelect = document.getElementById('village_id');
                if (villageSelect) {
                    villages.forEach(v => {
                        const option = document.createElement('option');
                        option.value = v.id;
                        option.textContent = `${v.name} (${v.district})`;
                        villageSelect.appendChild(option);
                    });
                }
            } catch (error) {
                console.error('Error loading villages:', error);
            }
        }

        document.getElementById('waterReportForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const formData = new FormData(e.target);
            const data = Object.fromEntries(formData.entries());

            try {
                const response = await fetch('/api/report/water', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                const result = await response.json();
                const msgBox = document.getElementById('messageBox');
                msgBox.classList.remove('hidden');
                if (response.ok) {
                    msgBox.className = 'mt-8 p-4 bg-green-100 text-green-700 rounded-xl';
                    msgBox.textContent = 'Report submitted successfully!';
                    e.target.reset();
                } else {
                    msgBox.className = 'mt-8 p-4 bg-red-100 text-red-700 rounded-xl';
                    msgBox.textContent = 'Error: ' + result.error;
                }
            } catch (error) {
                console.error('Error:', error);
            }
        });

        // Simple map init if needed
        window.initMap = function () {
            // Baseline map logic if required
        };
    </script>
</body>

</html>